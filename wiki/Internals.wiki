#summary Provide some details of some internals discovered while programming

= Luminance/Brightness/Light sensor =
The value of this sensor can't read directly. It can only be activated/deactived to control the brightness of the backlight.
The kernel references this device under drivers/video/backlight/bl_bd6083.c

= Updating the bionic to the kernel headers =
After changing kernel headers in the kernel source, do
{{{
cp -a kernel/include/{asm-generic,linux,mtd} bionic/libc/kernel/original/
cp -a kernel/arch/arm/include/asm bionic/libc/kernel/arch-arm 
cp -a kernel/arch/arm/mach-msm/include/mach/memory.h bionic/libc/kernel/arch-arm/asm/mach
cp out/target/product/openetna/obj/KERNEL_OBJ/include/asm-arm/mach-types.h bionic/libc/kernel/arch-arm/asm/
cd bionic/libc/kernel
./tools/update_all.py
#Revert some missing files
git checkout common/linux/binder.h
#Revert netfilter stuff - this needs alot adjustment
git clean -f -d common/linux/netfilter_ipv4/
git checkout HEAD -- common/linux/netfilter_ipv4
cp -a out/target/product/openetna/obj/KERNEL_OBJ/include/linux/version.h bionic/libc/kernel/common/linux/
}}}

Modify bionic/libc/kernel/arch-arm/asm/mach/memory.h
{{{
#ifndef __ASM_ARCH_MEMORY_H
#define __ASM_ARCH_MEMORY_H

+#define CONFIG_ARCH_MSM_ARM11
}}}

Modifiy bionic/libc/kernel/arch-arm/asm/memory.h
{{{
-#include <mach/memory.h>
+#include "mach/memory.h"
#include <asm/sizes.h>

+#define __deprecated
}}}

Modify the android/bionic/libc/kernel/arch-arm/asm/posix_types.h
{{{
-#if defined(__KERNEL__)
+#if !defined(__GLIBC__) || __GLIBC__ < 2
}}}

= Audio chip =
Used by libaudio (hardware/msm7k/libaudio), which interfaces it by ioctl's defined in msm_audio.h and which are processed by kernel/arch/arm/mach-msm/qdsp5/snd.c
The [http://datasheets.maxim-ic.com/en/ds/MAX9877.pdf MAX9877 amplifier] is used for speaker and headset amplification.

= The interface to the modem/radio =
Its all in arch/arm/mach-msm/smd_rpcrouter*
We do rpc calls to the modem or register servers which will answer rpc calls from the modem.
We provide servers in
{{{
drivers/power/lge_battery.c (our battery status)
arch/arm/mach-msm/rpc_server_misc.c (LG specific, something about FLEX)
arch/arm/mach-msm/rpc_server_time_remote.c
arch/arm/mach-msm/rpc_server_handset.c
arch/arm/mach-msm/rpc_server_dog_keepalive.c
}}}
[more to come]

= The screen =
The backlight is in kernel/drivers/video/backlight/bl_bd6083.c. It also includes the automatic brightness control.
The touchscreen is in kernel/drivers/input/touchscreen/msm_touch.c and
kernel/drivers/input/touchscreen/synaptics_i2c_rmi.c (both are somehow needed).
The framebuffer device and the mddi interfaces is under kernel/drivers/video/msm/.